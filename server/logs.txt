 in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer3.1.bn1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer3.1.bn1.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer3.1.conv2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer3.1.bn2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer3.1.bn2.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.conv1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.bn1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.bn1.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.conv2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.bn2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.bn2.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.downsample.0.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.downsample.1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.0.downsample.1.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.conv1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.bn1.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.bn1.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.conv2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.bn2.weight: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
/Users/kayttaja/Desktop/commision-tracker/server/venv/lib/python3.11/site-packages/torch/nn/modules/module.py:2025: UserWarning: for layer4.1.bn2.bias: copying from a non-meta parameter in the checkpoint to a meta parameter in the current model, which is a no-op. (Did you mean to pass `assign=True` to assign items in the state dictionary to their corresponding key in the module instead of copying them in place?)
  warnings.warn(f'for {key}: copying from a non-meta parameter in the checkpoint to a meta '
INFO:timm.models._builder:Missing keys (fc.weight, fc.bias) discovered while loading pretrained weights. This is expected if model is being adapted.
Some weights of the model checkpoint at microsoft/table-transformer-detection were not used when initializing TableTransformerForObjectDetection: ['model.backbone.conv_encoder.model.layer2.0.downsample.1.num_batches_tracked', 'model.backbone.conv_encoder.model.layer3.0.downsample.1.num_batches_tracked', 'model.backbone.conv_encoder.model.layer4.0.downsample.1.num_batches_tracked']
- This IS expected if you are initializing TableTransformerForObjectDetection from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing TableTransformerForObjectDetection from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
2025-11-05 20:30:55 | INFO | app.new_extraction_services.models.advanced_tableformer:_load_detection_model:44 | Table detection model loaded successfully
2025-11-05 20:30:55 | INFO | app.new_extraction_services.models.advanced_tableformer:_load_structure_model:76 | Table structure model loaded successfully
WARNING:easyocr.easyocr:Using CPU. Note: This module is much faster with a GPU.
2025-11-05 20:30:57 | INFO | app.new_extraction_services.models.advanced_ocr_engine:_init_ocr_engines:60 | EasyOCR engine initialized
2025-11-05 20:30:58 | INFO | app.new_extraction_services.models.advanced_ocr_engine:_init_ocr_engines:72 | Tesseract OCR engine initialized
2025-11-05 20:30:58 | INFO | app.new_extraction_services.models.advanced_ocr_engine:_init_ocr_engines:94 | Initialized 2 OCR engines to prevent OMP conflicts
INFO:app.services.company_name_service:spaCy not available, using pattern matching only
2025-11-05 20:30:58 | INFO | app.services.new_extraction_service:__init__:57 | New Extraction Service initialized successfully
INFO:app.services.company_name_service:spaCy not available, using pattern matching only
âœ… Set GOOGLE_DOCAI_PROCESSOR_ID to: 521303e404fb7809
âœ… Google Document AI initialized - Project: pdf-tables-extractor-465009, Processor: 521303e404fb7809
INFO:app.services.enhanced_extraction_service:âœ… Enhanced Extraction Service initialized
INFO:app.services.enhanced_extraction_service:ğŸ†• PRIMARY: Claude Document AI (extraction) + GPT-4 (AI operations)
INFO:app.services.enhanced_extraction_service:ğŸ“‹ FALLBACK: Mistral Document AI
INFO:app.services.enhanced_extraction_service:â±ï¸  Timeout management: {'metadata_extraction': 300, 'document_processing': 600, 'table_extraction': 1200, 'post_processing': 300, 'total_process': 1800}
INFO:app.services.enhanced_extraction_service:ğŸš€ Enhanced 3-phase pipeline: ENABLED
INFO:app.api.new_extract:âœ… Enhanced extraction service obtained (enhanced_mode=True)
INFO:app.api.new_extract:ğŸš€ Starting extraction task...
INFO:app.api.new_extract:ğŸ“Š Calling extract_tables_with_progress...
INFO:app.services.enhanced_extraction_service:âœ… Using Claude as primary extraction service
INFO:app.services.enhanced_extraction_service:âœ… CLAUDE service validated successfully
INFO:app.services.enhanced_extraction_service:Routing to Claude extraction (method: smart)
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage document_processing for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage document_processing for upload upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:ğŸ” Starting GPT metadata extraction...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage gpt_metadata_extraction for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:ğŸ“¡ Emitting extraction step...
INFO:app.services.enhanced_extraction_service:ğŸ“„ Calling _extract_metadata_with_gpt for file: pdfs/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Step started: Extracting Metadata (Step 2) for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:ğŸ” Starting _extract_metadata_with_gpt for file: pdfs/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.enhanced_extraction_service:Extracting metadata with GPT from first page of pdfs/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.enhanced_extraction_service:ğŸ“„ Opening PDF file: pdfs/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.enhanced_extraction_service:ğŸ“„ PDF has 1 pages, loading first page
INFO:app.services.enhanced_extraction_service:ğŸ–¼ï¸ Converting first page to image...
INFO:app.services.enhanced_extraction_service:ğŸ–¼ï¸ Converting to PIL Image...
INFO:app.services.enhanced_extraction_service:ğŸ–¼ï¸ Converting to base64...
INFO:app.services.enhanced_extraction_service:âœ… Converted first page to image (359344 chars)
INFO:app.services.enhanced_extraction_service:ğŸ” Checking GPT service availability...
INFO:app.services.enhanced_extraction_service:âœ… GPT-4 service is available
INFO:app.services.enhanced_extraction_service:Calling GPT-4 Vision API for metadata extraction
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO:app.services.enhanced_extraction_service:GPT-4 response: {
  "carrier_name": "ALLIED",
  "carrier_confidence": 0.95,
  "statement_date": "1/8/2025",
  "date_confidence": 0.90,
  "broker_company": "INNOVATIVE BPS LLC",
  "broker_confidence": 0.85,
  "evidence": "Carrier name found in the logo at the top left. Statement date labeled as 'Report Date' near the top right. Broker company found under the address section.",
  "summary": "Document name/number: ABSF Commission Payment Summary\nDocument date: 1/8/2025\nTotal amount: $1,027.20\nCurrency: USD\nVendor name: Allied Benefit Systems\nCustomer name: SOAR LOGISTICS LL\nAdditional metadata: Payment type: EFT\nComplete summary about the document: This is a commission payment summary from Allied Benefit Systems for the broker Innovative BPS LLC, detailing commissions for SOAR LOGISTICS LL with a total amount of $1,027.20."
}
INFO:app.services.extraction_utils:Date normalized: '1/8/2025' -> '2025-01-08'
INFO:app.services.enhanced_extraction_service:âœ… GPT metadata extraction successful: {'success': True, 'carrier_name': 'ALLIED', 'carrier_confidence': 0.95, 'statement_date': '2025-01-08', 'date_confidence': 0.9, 'broker_company': 'INNOVATIVE BPS LLC', 'broker_confidence': 0.85, 'summary': 'Document name/number: ABSF Commission Payment Summary\nDocument date: 1/8/2025\nTotal amount: $1,027.20\nCurrency: USD\nVendor name: Allied Benefit Systems\nCustomer name: SOAR LOGISTICS LL\nAdditional metadata: Payment type: EFT\nComplete summary about the document: This is a commission payment summary from Allied Benefit Systems for the broker Innovative BPS LLC, detailing commissions for SOAR LOGISTICS LL with a total amount of $1,027.20.', 'evidence': "Carrier name found in the logo at the top left. Statement date labeled as 'Report Date' near the top right. Broker company found under the address section.", 'extraction_method': 'gpt4o_vision_first_page'}
INFO:app.services.enhanced_extraction_service:âœ… GPT metadata marked as successful in result
INFO:app.services.enhanced_extraction_service:ğŸ“¤ Sending step progress with metadata...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:âœ… Step progress sent successfully
INFO:app.services.enhanced_extraction_service:ğŸ“¡ Emitting table_extraction step...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Step started: Processing Table Data (Step 3) for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage table_detection for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:Starting Claude extraction for pdfs/01.13.2025.2 Allied Innovative Payment.pdf (enhanced=True)
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.claude.service:Standard file (1 pages, 0.07MB)
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage document_processing for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage table_detection for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.claude.dynamic_prompts:No carrier-specific prompt found for 'ALLIED', using standard prompt only
INFO:app.services.claude.service:ğŸ“‹ No carrier-specific prompt for 'ALLIED', using standard prompt only
INFO:app.services.claude.service:Calling Claude API with model: claude-sonnet-4-20250514 (attempt 1/3)
INFO:app.api.websocket:Received unknown message type: heartbeat
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.services.claude.service:âœ… Claude API call successful. Tokens: {'input_tokens': 3069, 'output_tokens': 763}
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.extraction_utils:Header normalization: 10 headers normalized
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage table_detection for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage validation for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage validation for upload upload_1762367439243_b1uymyc0z
INFO:app.services.claude.service:ğŸš€ Running enhanced 3-phase extraction pipeline...
INFO:app.services.claude.service:   Phase 1: Document Intelligence âœ“ (completed)
INFO:app.services.claude.service:   Phase 2: Semantic Extraction â†’ Starting...
INFO:app.services.claude.service:   Phase 3: Intelligent Summarization â†’ Pending...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage semantic_analysis for upload upload_1762367439243_b1uymyc0z
INFO:app.services.claude.service:ğŸ“Š Phase 2: Semantic extraction and relationship mapping...
INFO:app.services.claude.semantic_extractor:ğŸ” Starting semantic extraction and relationship mapping...
INFO:app.services.claude.semantic_extractor:ğŸ“Š Extracted 0 writing agents: []
INFO:app.services.claude.semantic_extractor:ğŸ“Š Extracted 4 groups/companies
INFO:app.services.claude.semantic_extractor:âœ… Semantic extraction completed successfully
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage semantic_analysis for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage summary_generation for upload upload_1762367439243_b1uymyc0z
INFO:app.services.claude.service:âœï¸ Phase 3: Intelligent summarization...
INFO:app.services.claude.service:ğŸ“Š Semantic result keys: ['success', 'entities', 'relationships', 'business_intelligence', 'raw_tables']
INFO:app.services.claude.service:   - Entities: âœ…
INFO:app.services.claude.service:   - Relationships: âœ…
INFO:app.services.claude.service:   - Business Intelligence: âœ…
INFO:app.services.claude.service:ğŸ“ Summary service available: True
INFO:app.services.claude.service:ğŸš€ Calling generate_conversational_summary with use_enhanced=True...
INFO:app.services.conversational_summary_service:ğŸ—£ï¸ Generating conversational summary...
INFO:app.services.conversational_summary_service:ğŸ” _build_summary_prompt called:
INFO:app.services.conversational_summary_service:   - use_enhanced: True
INFO:app.services.conversational_summary_service:   - has_enhanced_data: True
INFO:app.services.conversational_summary_service:   - extraction_data keys: ['success', 'entities', 'relationships', 'business_intelligence', 'raw_tables']
INFO:app.services.conversational_summary_service:âœ… Using ENHANCED summary prompt (with enhanced prompts module)
INFO:app.services.conversational_summary_service:ğŸ¯ Building enhanced summary prompt...
INFO:app.services.conversational_summary_service:   - Entities: ['carrier', 'broker', 'writing_agents', 'groups_and_companies', 'document_metadata']
INFO:app.services.conversational_summary_service:   - Relationships: ['carrier_to_broker', 'broker_to_agents', 'agents_to_groups', 'groups_to_payments']
INFO:app.services.conversational_summary_service:   - Business Intelligence: ['total_commission_amount', 'number_of_groups', 'commission_structures', 'top_contributors', 'special_payments', 'payment_period', 'patterns_detected']
INFO:app.services.conversational_summary_service:âœ… SUCCESS: Enhanced prompts module imported
INFO:app.services.conversational_summary_service:ğŸš€ Using EnhancedClaudePrompts.get_intelligent_summarization_prompt()
INFO:app.services.conversational_summary_service:âœ… SUCCESS: Enhanced prompts imported correctly
INFO:app.services.conversational_summary_service:ğŸš€ Calling Claude API for summary generation...
INFO:app.services.conversational_summary_service:   Model: claude-sonnet-4-20250514
INFO:app.services.conversational_summary_service:   Max tokens: 1200
INFO:app.services.conversational_summary_service:   Prompt length: 8753 chars
INFO:app.services.conversational_summary_service:   System prompt length: 1421 chars
INFO:httpx:HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 200 OK"
INFO:app.services.conversational_summary_service:âœ… Claude API call successful
INFO:app.services.conversational_summary_service:   Response content blocks: 1
INFO:app.services.conversational_summary_service:ğŸ“„ Generated summary length: 791 characters
INFO:app.services.conversational_summary_service:ğŸ“„ Generated summary: This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. The document details a total of $1,027.20 in commissions, with SOAR LOGISTICS LL generating two distinct payment amounts: $419.93 (appearing twice) and $93.67 (also appearing twice), suggesting either multiple policy lines or billing period adjustments for this single client group. The payment structure appears to follow both percentage-based and Premium Equivalent commission calculations, though no specific writing agents are identified in the documentation, indicating this may be a direct broker relationship or simplified payment structure focused on a single logistics company client.
INFO:app.services.conversational_summary_service:âœ… Summary generated in 6.23s: This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, ...
INFO:app.services.claude.service:âœ… Summary generation completed. Success: True
INFO:app.services.claude.service:ğŸ“„ Generated summary (first 200 chars): This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. Th...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage summary_generation for upload upload_1762367439243_b1uymyc0z
INFO:app.services.claude.service:âœ… Enhanced 3-phase pipeline completed successfully
INFO:app.services.claude.service:ğŸ“¦ Enhanced result keys: ['success', 'tables', 'extraction_method', 'file_type', 'document_metadata', 'extracted_carrier', 'extracted_date', 'quality_summary', 'metadata', 'extraction_quality', 'entities', 'relationships', 'business_intelligence', 'summary', 'extraction_pipeline', 'semantic_extraction_success']
INFO:app.services.claude.service:   - Summary length: 791 characters
INFO:app.services.claude.service:   - Summary preview: This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGIST...
INFO:app.services.claude.service:âœ… Claude extraction completed in 19.18s
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
ğŸ“ Enhanced multi-strategy stitching: Processing 1 tables
ğŸ“ Canonical header identified: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount'] (10 columns)
ğŸ“ Table 1 headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount'] (10 columns)
ğŸ“ Found 1 unique header patterns
ğŸ“ Grouped 1 tables into 1 groups
ğŸ“ Merging group 1 with 1 tables
INFO:app.services.mistral.service:âœ… Mistral client initialized successfully
INFO:app.services.mistral.service:   Model: mistral-ocr-latest (Mistral OCR for Document AI)
INFO:app.services.mistral.service:   API Key: ****************************xGt2
INFO:app.services.mistral.service:Enhanced Mistral service initialized with summary detection and performance optimization
INFO:app.services.mistral.service:Applying enhancements to table with 4 rows
INFO:app.services.mistral.service:Phase 1: Applying professional bracket processing...
INFO:app.services.mistral.enhancement_config:Bracket processing recorded: 8 brackets converted
INFO:app.services.mistral.service:âœ“ Bracket processing: 8 values converted (20.0% conversion rate)
INFO:app.services.mistral.service:Phase 2: Applying multi-strategy summary detection...
INFO:app.services.mistral.enhancement_config:Summary detection recorded: 0 rows removed, confidence: 0.00
INFO:app.services.mistral.service:âœ“ Summary detection: No summary rows detected (confidence: 0.00%)
INFO:app.services.mistral.enhancement_config:Performance recorded: 0.00s (avg: 0.00s)
INFO:app.services.mistral.service:âœ“ Table enhancements completed in 0.00s
INFO:app.services.extraction_utils:âœ… Re-applied enhancements to merged table: 4 rows
ğŸ“ Merged table 1: 10 headers, 4 rows
ğŸ“ Merged headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ“ Enhanced stitching completed: 1 final tables
INFO:app.services.extraction_utils:Header normalization: 10 headers normalized
INFO:app.services.enhanced_extraction_service:Claude: Verified normalized headers
INFO:app.services.enhanced_extraction_service:Claude: Processed 1 tables into 1 tables
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed stage table_detection for upload upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:ğŸ¯ STAGE 3: CONVERSATIONAL SUMMARY GENERATION
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:   - Enhanced mode enabled: True
INFO:app.services.enhanced_extraction_service:   - Result has 'summary': True
INFO:app.services.enhanced_extraction_service:   - Summary service available: True
INFO:app.services.enhanced_extraction_service:âœ… Using enhanced summary from Claude pipeline
INFO:app.services.enhanced_extraction_service:   Summary length: 791 characters
INFO:app.services.enhanced_extraction_service:   Summary preview: This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. Th...
INFO:app.services.enhanced_extraction_service:ğŸ“¤ Sending Claude-generated summary to frontend via WebSocket NOW
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.enhanced_extraction_service:âœ… Claude-generated summary sent to frontend successfully
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:ğŸ“ FINAL SUMMARY SELECTION: ENHANCED CONVERSATIONAL
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:   Summary length: 791 characters
INFO:app.services.enhanced_extraction_service:   Full summary:
This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. The document details a total of $1,027.20 in commissions, with SOAR LOGISTICS LL generating two distinct payment amounts: $419.93 (appearing twice) and $93.67 (also appearing twice), suggesting either multiple policy lines or billing period adjustments for this single client group. The payment structure appears to follow both percentage-based and Premium Equivalent commission calculations, though no specific writing agents are identified in the documentation, indicating this may be a direct broker relationship or simplified payment structure focused on a single logistics company client.
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Started stage validation for upload upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: completion
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Completed processing for upload upload_1762367439243_b1uymyc0z in 31.91 seconds
INFO:app.api.new_extract:âœ… Extraction completed successfully: {'success': True, 'tables': [{'headers': ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount'], 'rows': [['L244338', 'SOAR LOGISTICS LL', '12/1/2024', '12/1/2024', '$9336.90', '$3514.94', '6%', 'Premium Equivalent', '4', '$93.67'], ['L244338', 'SOAR LOGISTICS LL', '12/1/2024', '12/1/2024', '$9336.90', '$3514.94', '6%', 'Premium Equivalent', '19', '$419.93'], ['L244338', 'SOAR LOGISTICS LL', '1/1/2025', '1/1/2025', '$9336.90', '$3514.94', '6%', 'Premium Equivalent', '4', '$93.67'], ['L244338', 'SOAR LOGISTICS LL', '1/1/2025', '1/1/2025', '$9336.90', '$3514.94', '6%', 'Premium Equivalent', '19', '$419.93']], 'table_type': 'commission_table', 'page_number': 1, 'confidence_score': 0.98, 'summary_rows': [4, 5], 'metadata': {'total_tables_merged': 1, 'total_rows': 4, 'canonical_header': ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount'], 'merged_from_tables': [0]}, 'summaryRows': [], 'bracket_processing': {'enabled': True, 'total_cells_processed': 40, 'brackets_converted': 8, 'errors': 0, 'processing_method': 'professional_accounting_standard', 'validation': {'total_cells_checked': 40, 'negative_indicators_before': 0, 'negative_values_after': 0, 'data_integrity_preserved': True, 'validation_errors': []}}, 'summary_detection': {'enabled': True, 'removed_indices': [], 'detection_method': 'multi_strategy_conservative', 'detection_confidence': 0.0, 'total_rows_before': 4, 'total_rows_after': 4, 'removal_threshold': 0.75, 'strategies_used': ['semantic', 'density', 'position', 'business_logic']}, 'header': ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']}], 'extraction_method': 'claude', 'file_type': 'pdf', 'document_metadata': {'carrier_name': 'Allied Benefit Systems', 'carrier_confidence': 0.95, 'statement_date': '2025-01-08', 'date_confidence': 0.92, 'broker_company': 'INNOVATIVE BPS LLC', 'broker_confidence': 0.95, 'total_pages': 1, 'file_size_mb': 0.07360172271728516, 'extraction_method': 'claude', 'claude_model': 'claude-sonnet-4-20250514'}, 'extracted_carrier': 'Allied Benefit Systems', 'extracted_date': '2025-01-08', 'quality_summary': {'overall_confidence': 0.98, 'table_structure_score': 1.0, 'data_completeness': 1.0, 'extraction_accuracy': 0.98, 'issues_detected': [], 'quality_grade': 'A', 'table_count': 1}, 'metadata': {'table_count': 1, 'quality_grade': 'A', 'confidence_score': 0.98, 'token_usage': {'input_tokens': 3069, 'output_tokens': 763}}, 'extraction_quality': {'overall_confidence': 0.98, 'table_structure_score': 1.0, 'data_completeness': 1.0, 'extraction_accuracy': 0.98, 'issues_detected': [], 'quality_grade': 'A', 'table_count': 1}, 'entities': {'carrier': {'name': 'Allied Benefit Systems', 'confidence': 0.95, 'evidence': 'Document metadata'}, 'broker': {'company_name': 'INNOVATIVE BPS LLC', 'confidence': 0.95, 'evidence': 'Document metadata'}, 'writing_agents': [], 'groups_and_companies': [{'group_name': 'SOAR LOGISTICS LL', 'group_number': None, 'paid_amount': '$93.67'}, {'group_name': 'SOAR LOGISTICS LL', 'group_number': None, 'paid_amount': '$419.93'}, {'group_name': 'SOAR LOGISTICS LL', 'group_number': None, 'paid_amount': '$93.67'}, {'group_name': 'SOAR LOGISTICS LL', 'group_number': None, 'paid_amount': '$419.93'}], 'document_metadata': {'carrier_name': 'Allied Benefit Systems', 'carrier_confidence': 0.95, 'statement_date': '2025-01-08', 'date_confidence': 0.92, 'broker_company': 'INNOVATIVE BPS LLC', 'broker_confidence': 0.95, 'total_pages': 1, 'file_size_mb': 0.07360172271728516, 'extraction_method': 'claude', 'claude_model': 'claude-sonnet-4-20250514'}}, 'relationships': {'carrier_to_broker': {'carrier': 'Allied Benefit Systems', 'broker': 'INNOVATIVE BPS LLC', 'relationship': 'issues_commission_to'}, 'broker_to_agents': [], 'agents_to_groups': [{'agent': 'Unknown', 'group': 'SOAR LOGISTICS LL', 'relationship': 'manages'}, {'agent': 'Unknown', 'group': 'SOAR LOGISTICS LL', 'relationship': 'manages'}, {'agent': 'Unknown', 'group': 'SOAR LOGISTICS LL', 'relationship': 'manages'}, {'agent': 'Unknown', 'group': 'SOAR LOGISTICS LL', 'relationship': 'manages'}], 'groups_to_payments': [{'group': 'SOAR LOGISTICS LL', 'amount': '$93.67', 'relationship': 'generates_commission'}, {'group': 'SOAR LOGISTICS LL', 'amount': '$419.93', 'relationship': 'generates_commission'}, {'group': 'SOAR LOGISTICS LL', 'amount': '$93.67', 'relationship': 'generates_commission'}, {'group': 'SOAR LOGISTICS LL', 'amount': '$419.93', 'relationship': 'generates_commission'}]}, 'business_intelligence': {'total_commission_amount': 'Not specified', 'number_of_groups': 4, 'commission_structures': ['Percentage-based', 'Premium Equivalent'], 'top_contributors': [{'name': 'SOAR LOGISTICS LL', 'amount': '$419.93'}, {'name': 'SOAR LOGISTICS LL', 'amount': '$419.93'}, {'name': 'SOAR LOGISTICS LL', 'amount': '$93.67'}], 'special_payments': [], 'payment_period': '', 'patterns_detected': ['Standard commission structure']}, 'summary': 'This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. The document details a total of $1,027.20 in commissions, with SOAR LOGISTICS LL generating two distinct payment amounts: $419.93 (appearing twice) and $93.67 (also appearing twice), suggesting either multiple policy lines or billing period adjustments for this single client group. The payment structure appears to follow both percentage-based and Premium Equivalent commission calculations, though no specific writing agents are identified in the documentation, indicating this may be a direct broker relationship or simplified payment structure focused on a single logistics company client.', 'extraction_pipeline': '3-phase-enhanced', 'semantic_extraction_success': True}
INFO:app.services.cancellation_manager:Cleared cancellation status for upload upload_1762367439243_b1uymyc0z
INFO:app.api.new_extract:ğŸ’¾ Updating upload record with results...
INFO:app.api.new_extract:âœ… Upload record updated successfully
INFO:app.services.audit_logging_service:Audit: data_view by user f6cf1764-5bfc-4352-abd9-81b72b7cf191 on extraction_complete (ID: 735323c6-ce25-4dd1-8276-7c21f5a3d109)
INFO:app.api.new_extract:ğŸ¯ Format Learning: Using carrier Allied Benefit Systems with ID 22a632c3-1d14-415a-9411-7e451c18dfde
WARNING:app.api.new_extract:ğŸš¨ CARRIER MISMATCH DETECTED: File uploaded to aa4a116d-b561-4eae-a3cc-7b0bda919685 but extracted as Allied Benefit Systems (22a632c3-1d14-415a-9411-7e451c18dfde)
INFO:app.api.new_extract:ğŸ”„ Reassigning file to correct carrier: Allied Benefit Systems
INFO:app.services.gcs_utils:âœ… File copied in GCS: statements/735323c6-ce25-4dd1-8276-7c21f5a3d109/01.13.2025.2 Allied Innovative Payment.pdf -> statements/22a632c3-1d14-415a-9411-7e451c18dfde/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.gcs_utils:âœ… File deleted from GCS: statements/735323c6-ce25-4dd1-8276-7c21f5a3d109/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.services.gcs_utils:âœ… Generated signed URL for GCS file with inline headers: statements/22a632c3-1d14-415a-9411-7e451c18dfde/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.api.new_extract:âœ… File moved to correct carrier folder in GCS: statements/22a632c3-1d14-415a-9411-7e451c18dfde/01.13.2025.2 Allied Innovative Payment.pdf
INFO:app.api.new_extract:âœ… Updated statement upload: carrier_id=22a632c3-1d14-415a-9411-7e451c18dfde, company_id=22a632c3-1d14-415a-9411-7e451c18dfde
INFO:app.api.new_extract:ğŸ“Š Single table detected, using it for field mapping
INFO:app.api.new_extract:ğŸ¯ Using table 0 for field mapping with 10 headers
ğŸ¯ FormatLearningService: Finding matching format for company 22a632c3-1d14-415a-9411-7e451c18dfde
ğŸ¯ FormatLearningService: Headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ¯ FormatLearningService: Table structure: {'row_count': 4, 'column_count': 10, 'has_financial_data': True}
ğŸ¯ FormatLearningService: Headers type: <class 'list'>
ğŸ¯ FormatLearningService: Headers length: 10
ğŸ¯ CRUD: Finding best matching format for company 22a632c3-1d14-415a-9411-7e451c18dfde
ğŸ¯ CRUD: Input headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ¯ CRUD: Input table structure: {'row_count': 4, 'column_count': 10, 'has_financial_data': True}
ğŸ¯ CRUD: Found 4 saved formats for company
ğŸ¯ CRUD: Comparing with saved format:
ğŸ¯ CRUD:   Saved headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ¯ CRUD:   Header similarity: 0.8
ğŸ¯ CRUD:   Structure similarity: 0.0
ğŸ¯ CRUD:   Total score: 0.6400000000000001
ğŸ¯ CRUD:   -> New best match with score 0.6400000000000001
ğŸ¯ CRUD: Comparing with saved format:
ğŸ¯ CRUD:   Saved headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ¯ CRUD:   Header similarity: 0.8
ğŸ¯ CRUD:   Structure similarity: 1.0
ğŸ¯ CRUD:   Total score: 0.8400000000000001
ğŸ¯ CRUD:   -> New best match with score 0.8400000000000001
ğŸ¯ CRUD: Comparing with saved format:
ğŸ¯ CRUD:   Saved headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent Rate', 'Calculation Method', 'Census Ct.', 'Paid Amount']
ğŸ¯ CRUD:   Header similarity: 0.7200000000000001
ğŸ¯ CRUD:   Structure similarity: 1.0
ğŸ¯ CRUD:   Total score: 0.776
ğŸ¯ CRUD: Comparing with saved format:
ğŸ¯ CRUD:   Saved headers: ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Census Ct.', 'Calculation Method', 'Agent Rate', 'Paid Amount']
ğŸ¯ CRUD:   Header similarity: 0.6400000000000001
ğŸ¯ CRUD:   Structure similarity: 1.0
ğŸ¯ CRUD:   Total score: 0.7120000000000002
ğŸ¯ FormatLearningService: Best match score: 0.8400000000000001
ğŸ¯ FormatLearningService: Found matching format with signature: 434609905947a9e8728df0b79ba381ce
ğŸ¯ FormatLearningService: Learned field mapping: {}
ğŸ¯ FormatLearningService: Learned table editor settings: {'headers': ['Group No.', 'Group Name', 'Billing Period', 'Adj. Period', 'Invoice Total', 'Stoploss Total', 'Agent %', 'Calculation Method', 'Census Ct.', 'Paid Amount'], 'summary_rows': [], 'corrected_carrier_name': 'Allied Benefit Systems', 'corrected_statement_date': '2025-01-08', 'user_corrections': {'carrier_name': 'Allied Benefit Systems', 'statement_date': '2025-01-08'}}
INFO:app.api.new_extract:ğŸ¯ Format Learning: Found matching format with score 0.8400000000000001
INFO:app.api.new_extract:ğŸ¯ Format Learning: Applying corrected carrier name from learned format: Allied Benefit Systems
INFO:app.api.new_extract:ğŸ¯ Format Learning: Skipping statement date auto-apply (dates are document-specific)
INFO:app.services.ai_plan_type_detection_service:AI Plan Type Detection Service initialized successfully
INFO:app.api.new_extract:ğŸ” AI Plan Type Detection: Detecting plan types during extraction
INFO:app.services.ai_plan_type_detection_service:ğŸ” AI Plan Detection: Analyzing document for insurance plan types
INFO:httpx:HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
INFO:app.services.ai_plan_type_detection_service:âœ… AI successfully detected plan types
INFO:app.services.ai_plan_type_detection_service:âœ… AI Plan Detection: Found 1 plan types with 0.90 confidence
INFO:app.api.new_extract:âœ… AI Plan Detection: 1 plan types with 0.90 confidence
INFO:app.api.new_extract:ğŸ§  AI Field Mapping: Starting field mapping during extraction
INFO:app.api.ai_intelligent_mapping:ğŸš€ Enhanced AI Analysis Request: User muhammad@pinecrestconsulting.com
INFO:app.services.ai_field_mapping_service:ğŸ¤– AI Mapping: Analyzing 10 headers with AI intelligence
INFO:app.services.ai_field_mapping_service:ğŸ” AI Mapping: carrier_id provided: True (value: 22a632c3-1d14-415a-9411-7e451c18dfde)
INFO:app.api.websocket:Received unknown message type: heartbeat
INFO:app.services.ai_field_mapping_service:ğŸ¯ Carrier ID is valid, attempting to retrieve learned mapping for carrier 22a632c3-1d14-415a-9411-7e451c18dfde
INFO:app.services.ai_field_mapping_service:ğŸ” Generated format signature for lookup: 434609905947a9e8728df0b79ba381ce
INFO:app.services.ai_field_mapping_service:ğŸ” Looking up learned format for carrier 22a632c3-1d14-415a-9411-7e451c18dfde with 10 headers
INFO:app.services.ai_field_mapping_service:âŒ No exact match found, trying fuzzy matching...
INFO:app.services.ai_field_mapping_service:ğŸ” Found 4 saved formats for fuzzy matching
INFO:app.services.ai_field_mapping_service:ğŸ” Format signature 6f736ac611e1789c131a993b10321314: similarity = 0.72
INFO:app.services.ai_field_mapping_service:âœ… New best match with similarity 0.72
INFO:app.services.ai_field_mapping_service:ğŸ” Format signature 55acb8178c0628d94935cf3ef7fed712: similarity = 0.64
INFO:app.services.ai_field_mapping_service:ğŸ” Format signature f160e649963cd7cd90e82fb19c3898e8: similarity = 0.80
INFO:app.services.ai_field_mapping_service:âœ… New best match with similarity 0.80
INFO:app.services.ai_field_mapping_service:âœ… Found similar format with 0.80 similarity score
INFO:app.services.ai_field_mapping_service:ğŸ¯ Found learned mapping for carrier with 0.80 confidence
INFO:app.services.ai_field_mapping_service:ğŸ¯ Using learned mappings directly with match score 0.8
INFO:app.services.ai_field_mapping_service:âœ… Learned field_mapping contains 10 mappings
WARNING:app.services.ai_field_mapping_service:âš ï¸ Learned mapping produced 0 actual mappings - falling through to AI generation
WARNING:app.services.ai_field_mapping_service:âš ï¸ All 10 headers will be mapped by AI instead
INFO:httpx:HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
INFO:app.services.ai_field_mapping_service:âœ… AI successfully generated field mappings
INFO:app.services.ai_field_mapping_service:âœ… AI Mapping: Generated 10 mappings with 0.88 confidence
INFO:app.services.ai_plan_type_detection_service:ğŸ” AI Plan Detection: Analyzing document for insurance plan types
INFO:httpx:HTTP Request: POST https://api.mistral.ai/v1/chat/completions "HTTP/1.1 200 OK"
INFO:app.services.ai_plan_type_detection_service:âœ… AI successfully detected plan types
INFO:app.services.ai_plan_type_detection_service:âœ… AI Plan Detection: Found 1 plan types with 0.90 confidence
INFO:app.api.ai_intelligent_mapping:âœ… Enhanced AI Analysis Complete: Overall confidence 0.89
INFO:app.api.new_extract:âœ… AI Field Mapping: 10 mappings with 0.88 confidence
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Step started: Finalizing (Step 6) for upload_id upload_1762367439243_b1uymyc0z
INFO:app.api.new_extract:âœ… Enhanced summary already generated by Claude pipeline - using it
INFO:app.api.new_extract:   Enhanced summary: This is  a commission statement from Allied Benefit Systems for INNOVATIVE BPS LLC dated January 8, 2025, showing payments exclusively for SOAR LOGISTICS LL across four separate commission entries. The document details a total of $1,027.20 in commissions, with SOAR LOGISTICS LL generating two distinct payment amounts: $419.93 (appearing twice) and $93.67 (also appearing twice), suggesting either multiple policy lines or billing period adjustments for this single client group. The payment structure appears to follow both percentage-based and Premium Equivalent commission calculations, though no specific writing agents are identified in the documentation, indicating this may be a direct broker relationship or simplified payment structure focused on a single logistics company client.
INFO:app.services.user_profile_service:Recorded contribution: upload for user f6cf1764-5bfc-4352-abd9-81b72b7cf191
INFO:app.services.audit_logging_service:Audit: file_upload by user f6cf1764-5bfc-4352-abd9-81b72b7cf191 on statement_upload (ID: 735323c6-ce25-4dd1-8276-7c21f5a3d109)
INFO:app.api.new_extract:ğŸ“¤ Sending pre-generated enhanced summary via WebSocket...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1762367439243_b1uymyc0z: EXTRACTION_COMPLETE
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1762367439243_b1uymyc0z
INFO:app.services.websocket_service:Extraction complete for upload_id upload_1762367439243_b1uymyc0z
INFO:app.api.new_extract:âœ… Extraction complete! Sent results via WebSocket for upload_id: upload_1762367439243_b1uymyc0z
INFO:     127.0.0.1:63439 - "POST /api/extract-tables-smart/ HTTP/1.1" 200 OK
INFO:     connection closed
INFO:app.api.websocket:WebSocket disconnected: upload_id=upload_1762367439243_b1uymyc0z, session_id=session_1762367439288_9n1i0vfg7
INFO:app.services.websocket_service:WebSocket disconnected: upload_id=upload_1762367439243_b1uymyc0z, session_id=session_1762367439288_9n1i0vfg7
INFO:app.api.websocket:WebSocket cleanup completed for upload_id=upload_1762367439243_b1uymyc0z
