(base) kayttaja@Kayttajas-MacBook-Pro commision-tracker % cd server
(base) kayttaja@Kayttajas-MacBook-Pro server % source venv/bin/activ
ate
(venv) (base) kayttaja@Kayttajas-MacBook-Pro server % uvicorn app.ma
in:app --reload
INFO:     Will watch for changes in these directories: ['/Users/kayttaja/Desktop/commision-tracker/server']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [7002] using StatReload
‚úÖ Using Render PostgreSQL database
‚úÖ Using Render PostgreSQL database
INFO:app.services.company_name_service:spaCy not available, using pattern matching only
INFO:app.services.gpt4o_vision_service:GPT-5 Vision service initialized successfully
INFO:app.services.gpt.retry_handler:üîß Rate limiter initialized: 45 RPM, 360,000 TPM
INFO:app.services.gpt.circuit_breaker:üîå Circuit breaker initialized: threshold=5, timeout=30s
INFO:app.services.gpt.vision_extractor:‚úÖ GPT-5 PDF Extractor initialized (Responses API mode with direct PDF upload)
INFO:app.services.gpt.batch_processor:‚úÖ Batch Processor initialized (Direct PDF mode)
INFO:app.services.gpt.enhanced_service:‚úÖ Initialized with direct PDF upload support (November 2025)
INFO:app.services.gpt.enhanced_service:‚úÖ Enhanced GPT-5 Vision Service initialized (Direct PDF mode)
INFO:app.services.ai_field_mapping_service:AI Field Mapping Service initialized successfully
INFO:app.services.ai_plan_type_detection_service:AI Plan Type Detection Service initialized successfully
INFO:app.services.gcs_utils:‚úÖ GCS initialized - Project: pdf-tables-extractor-465009, Bucket: pdf_extraction_files_saver
üåê CORS Configuration - Allowed Origins: ['http://localhost:3000', 'http://127.0.0.1:3000', 'https://commission-tracker-1.onrender.com', 'https://commission-tracker-ochre.vercel.app']
INFO:     Started server process [7014]
INFO:     Waiting for application startup.
INFO:app.main:üöÄ Application starting up...
INFO:app.main:‚úÖ Orphan cleanup scheduler started (runs every 3 minutes)
INFO:app.services.process_monitor:Process monitor initialized: max_time=1800s, heartbeat_timeout=300s
INFO:app.services.process_monitor:Process monitoring started
INFO:app.main:Process monitoring started for large file processing
INFO:app.main:Application startup complete with enhanced monitoring and signal handlers
INFO:app.services.orphan_cleanup_service:üöÄ Starting orphan cleanup scheduler (runs every 3 minutes)
INFO:app.services.orphan_cleanup_service:üßπ Starting orphan cleanup job...
INFO:app.services.process_monitor:Starting process monitoring loop
INFO:     Application startup complete.
INFO:app.main:Cleaned up 500 expired/inactive sessions
INFO:app.services.orphan_cleanup_service:‚úÖ Orphan cleanup completed: no orphans found
INFO:app.services.orphan_cleanup_service:üßπ Starting orphan cleanup job...
INFO:app.services.orphan_cleanup_service:‚úÖ Orphan cleanup completed: no orphans found
üîç Auth Status - All cookies: ['session_token', 'refresh_token']
üîç Auth Status - Access token present: False
üîç Auth Status - Request host: localhost:8000
üîç Auth Status - Request origin: http://localhost:3000
üîç Auth Status - Cookie session_token: 3c12155c-6fff-4ae7-b...
üîç Auth Status - Cookie refresh_token: eyJhbGciOiJIUzI1NiIs...
INFO:     127.0.0.1:50188 - "GET /api/auth/otp/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:50191 - "OPTIONS /environments HTTP/1.1" 200 OK
INFO:     127.0.0.1:50188 - "GET /environments HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50196 - "OPTIONS /api/auth/otp/request HTTP/1.1" 200 OK
‚ö†Ô∏è Redis connection failed: Error 61 connecting to localhost:6379. Connection refused.
‚ö†Ô∏è OTP service will use database-only mode
‚úÖ OTP email sent to muhammad@pinecrestconsulting.com
INFO:app.services.audit_logging_service:Audit: logout by user a0a721cb-b9fa-46a8-afcc-2892cf1a528c on user_authentication
INFO:     127.0.0.1:50198 - "POST /api/auth/otp/request HTTP/1.1" 200 OK
INFO:     127.0.0.1:50460 - "OPTIONS /api/auth/otp/verify HTTP/1.1" 200 OK
üç™ Setting cookies for user muhammad@pinecrestconsulting.com
üç™ Request origin: http://localhost:3000
üç™ Request host: localhost:8000
üç™ Request URL: http://localhost:8000/api/auth/otp/verify
üç™ Request scheme: http
üç™ Response object type: <class 'starlette.responses.Response'>
üç™ Response has set_cookie method: True
üç™ Response headers before: {}
üç™ Response status code: None
üç™ Environment variables:
üç™   ENVIRONMENT: not_set
üç™   NODE_ENV: not_set
üç™   RENDER: not_set
üç™   PORT: not_set
üç™ HTTPS Detection:
üç™   request.url.scheme: http
üç™   x-forwarded-proto: not_set
üç™   x-forwarded-ssl: not_set
üç™   x-forwarded-scheme: not_set
üç™   Final is_https: False
üç™ Environment check: is_production=False, is_render=False, is_https=False
üç™ Cross-origin check: origin=http://localhost:3000, host=localhost:8000, origin_domain=localhost:3000, is_cross_origin=True
üç™ Using samesite=lax
‚ö†Ô∏è  Local development cross-origin detected - using samesite=lax (samesite=none requires HTTPS)
üç™ Setting cookie: access_token with samesite=lax, secure=False
üç™ Using local development cookie settings for access_token
üç™ Cookie access_token set successfully
üç™ Set-Cookie headers for access_token: ['access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmNmNmMTc2NC01YmZjLTQzNTItYWJkOS04MWI3MmI3Y2YxOTEiLCJlbWFpbCI6Im11aGFtbWFkQHBpbmVjcmVzdGNvbnN1bHRpbmcuY29tIiwicm9sZSI6ImFkbWluIiwiY29tcGFueV9pZCI6ImQ4ODNhODY1LWE1NGYtNDFkNi05NjhlLWY5NGMzY2IzZjU4OSIsImFjY2Vzc19sZXZlbCI6ImJhc2ljIiwiZXhwIjoxNzYzNzQzMTY4LCJ0eXBlIjoiYWNjZXNzIiwiaWF0IjoxNzYzNzM5NTY4LCJqdGkiOiIxZTEzMzcwMTc3NmNlZjZlZDY3NGU0YzczMzU3OWI1MyJ9.-XmYUDoKRPsa6rQa4A6_nHoo25TY2yBPcHDDP0L3VvA; HttpOnly; Max-Age=3600; Path=/; SameSite=lax']
üç™ Environment variables:
üç™   ENVIRONMENT: not_set
üç™   NODE_ENV: not_set
üç™   RENDER: not_set
üç™   PORT: not_set
üç™ HTTPS Detection:
üç™   request.url.scheme: http
üç™   x-forwarded-proto: not_set
üç™   x-forwarded-ssl: not_set
üç™   x-forwarded-scheme: not_set
üç™   Final is_https: False
üç™ Environment check: is_production=False, is_render=False, is_https=False
üç™ Cross-origin check: origin=http://localhost:3000, host=localhost:8000, origin_domain=localhost:3000, is_cross_origin=True
üç™ Using samesite=lax
‚ö†Ô∏è  Local development cross-origin detected - using samesite=lax (samesite=none requires HTTPS)
üç™ Setting cookie: refresh_token with samesite=lax, secure=False
üç™ Using local development cookie settings for refresh_token
üç™ Cookie refresh_token set successfully
üç™ Set-Cookie headers for refresh_token: ['access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmNmNmMTc2NC01YmZjLTQzNTItYWJkOS04MWI3MmI3Y2YxOTEiLCJlbWFpbCI6Im11aGFtbWFkQHBpbmVjcmVzdGNvbnN1bHRpbmcuY29tIiwicm9sZSI6ImFkbWluIiwiY29tcGFueV9pZCI6ImQ4ODNhODY1LWE1NGYtNDFkNi05NjhlLWY5NGMzY2IzZjU4OSIsImFjY2Vzc19sZXZlbCI6ImJhc2ljIiwiZXhwIjoxNzYzNzQzMTY4LCJ0eXBlIjoiYWNjZXNzIiwiaWF0IjoxNzYzNzM5NTY4LCJqdGkiOiIxZTEzMzcwMTc3NmNlZjZlZDY3NGU0YzczMzU3OWI1MyJ9.-XmYUDoKRPsa6rQa4A6_nHoo25TY2yBPcHDDP0L3VvA; HttpOnly; Max-Age=3600; Path=/; SameSite=lax']
üç™ Environment variables:
üç™   ENVIRONMENT: not_set
üç™   NODE_ENV: not_set
üç™   RENDER: not_set
üç™   PORT: not_set
üç™ HTTPS Detection:
üç™   request.url.scheme: http
üç™   x-forwarded-proto: not_set
üç™   x-forwarded-ssl: not_set
üç™   x-forwarded-scheme: not_set
üç™   Final is_https: False
üç™ Environment check: is_production=False, is_render=False, is_https=False
üç™ Cross-origin check: origin=http://localhost:3000, host=localhost:8000, origin_domain=localhost:3000, is_cross_origin=True
üç™ Using samesite=lax
‚ö†Ô∏è  Local development cross-origin detected - using samesite=lax (samesite=none requires HTTPS)
üç™ Setting cookie: session_token with samesite=lax, secure=False
üç™ Using local development cookie settings for session_token
üç™ Cookie session_token set successfully
üç™ Set-Cookie headers for session_token: ['access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmNmNmMTc2NC01YmZjLTQzNTItYWJkOS04MWI3MmI3Y2YxOTEiLCJlbWFpbCI6Im11aGFtbWFkQHBpbmVjcmVzdGNvbnN1bHRpbmcuY29tIiwicm9sZSI6ImFkbWluIiwiY29tcGFueV9pZCI6ImQ4ODNhODY1LWE1NGYtNDFkNi05NjhlLWY5NGMzY2IzZjU4OSIsImFjY2Vzc19sZXZlbCI6ImJhc2ljIiwiZXhwIjoxNzYzNzQzMTY4LCJ0eXBlIjoiYWNjZXNzIiwiaWF0IjoxNzYzNzM5NTY4LCJqdGkiOiIxZTEzMzcwMTc3NmNlZjZlZDY3NGU0YzczMzU3OWI1MyJ9.-XmYUDoKRPsa6rQa4A6_nHoo25TY2yBPcHDDP0L3VvA; HttpOnly; Max-Age=3600; Path=/; SameSite=lax']
üç™ Cookies set successfully
üç™ Response headers after setting cookies: {'set-cookie': 'access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJmNmNmMTc2NC01YmZjLTQzNTItYWJkOS04MWI3MmI3Y2YxOTEiLCJlbWFpbCI6Im11aGFtbWFkQHBpbmVjcmVzdGNvbnN1bHRpbmcuY29tIiwicm9sZSI6ImFkbWluIiwiY29tcGFueV9pZCI6ImQ4ODNhODY1LWE1NGYtNDFkNi05NjhlLWY5NGMzY2IzZjU4OSIsImFjY2Vzc19sZXZlbCI6ImJhc2ljIiwiZXhwIjoxNzYzNzQzMTY4LCJ0eXBlIjoiYWNjZXNzIiwiaWF0IjoxNzYzNzM5NTY4LCJqdGkiOiIxZTEzMzcwMTc3NmNlZjZlZDY3NGU0YzczMzU3OWI1MyJ9.-XmYUDoKRPsa6rQa4A6_nHoo25TY2yBPcHDDP0L3VvA; HttpOnly; Max-Age=3600; Path=/; SameSite=lax'}
INFO:app.services.audit_logging_service:Audit: logout by user f6cf1764-5bfc-4352-abd9-81b72b7cf191 on user_authentication
INFO:     127.0.0.1:50462 - "POST /api/auth/otp/verify HTTP/1.1" 200 OK
üîç Debug - All cookies received: ['__next_hmr_refresh_hash__', 'access_token', 'refresh_token', 'session_token']
üîç Debug - Access token present: True
INFO:     127.0.0.1:50497 - "GET /api/auth/permissions HTTP/1.1" 200 OK
INFO:     127.0.0.1:50462 - "GET /environments HTTP/1.1" 200 OK
INFO:     127.0.0.1:50497 - "GET /api/earned-commission/carriers-detailed?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50504 - "GET /api/dashboard/earned-commissions?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50506 - "GET /api/earned-commission/carriers HTTP/1.1" 200 OK
INFO:     127.0.0.1:50502 - "GET /api/dashboard/stats?view_mode=my_data HTTP/1.1" 200 OK
INFO:     127.0.0.1:50462 - "GET /api/earned-commission/companies-aggregated?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50500 - "GET /api/earned-commission/stats?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50497 - "GET /api/earned-commission/stats?view_mode=my_data&year=2025&environment_id=9f4a7a57-5715-4b1e-98a9-b9901726a485 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50504 - "GET /api/dashboard/stats?view_mode=my_data&environment_id=9f4a7a57-5715-4b1e-98a9-b9901726a485 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50506 - "GET /api/dashboard/earned-commissions?view_mode=my_data&year=2025&environment_id=9f4a7a57-5715-4b1e-98a9-b9901726a485 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50462 - "GET /api/earned-commission/companies-aggregated?view_mode=my_data&year=2025&environment_id=9f4a7a57-5715-4b1e-98a9-b9901726a485 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50502 - "GET /api/earned-commission/carriers-detailed?view_mode=my_data&year=2025&environment_id=9f4a7a57-5715-4b1e-98a9-b9901726a485 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50500 - "GET /api/earned-commission/carriers-detailed?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50497 - "GET /api/dashboard/earned-commissions?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50504 - "GET /api/earned-commission/carriers HTTP/1.1" 200 OK
INFO:     127.0.0.1:50462 - "GET /api/earned-commission/companies-aggregated?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50506 - "GET /api/dashboard/stats?view_mode=my_data HTTP/1.1" 200 OK
INFO:     127.0.0.1:50502 - "GET /api/earned-commission/stats?view_mode=my_data&year=2025 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50770 - "GET /api/database-fields/?active_only=true HTTP/1.1" 200 OK
INFO:     127.0.0.1:50770 - "GET /api/database-fields/?active_only=true HTTP/1.1" 200 OK
WARNING:app.api.websocket:WebSocket connection without explicit token for upload_id=upload_1763739631732_kd3owj46q. This is allowed for progress tracking, but consider implementing token passing for production.
INFO:app.api.websocket:Attempting to connect WebSocket for upload_id: upload_1763739631732_kd3owj46q, session_id: session_1763739631754_7w2c1ychd
INFO:     127.0.0.1:50796 - "WebSocket /api/ws/progress/upload_1763739631732_kd3owj46q?session_id=session_1763739631754_7w2c1ychd" [accepted]
INFO:app.services.websocket_service:WebSocket connected: upload_id=upload_1763739631732_kd3owj46q, session_id=session_1763739631754_7w2c1ychd, timeout=1800s
INFO:     connection open
INFO:app.api.websocket:WebSocket connected successfully for upload_id: upload_1763739631732_kd3owj46q, session_id: session_1763739631754_7w2c1ychd
INFO:app.api.websocket:Started keepalive task for upload_id=upload_1763739631732_kd3owj46q
INFO:     127.0.0.1:50802 - "OPTIONS /api/extract-tables-smart/ HTTP/1.1" 200 OK
INFO:app.services.orphan_cleanup_service:üßπ Starting orphan cleanup job...
INFO:app.api.new_extract:üìÅ File: 08.06.2025 Allied Innovative Payment 2.pdf, Size: 227321 bytes, Hash: 98272fc00893adae..., User: f6cf1764-5bfc-4352-abd9-81b72b7cf191
INFO:app.api.new_extract:üîç Checking for duplicates BEFORE proceeding with upload...
INFO:app.api.new_extract:‚úÖ No duplicate found - proceeding with upload for file: 08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.api.new_extract:üöÄ Starting extraction: 08.06.2025 Allied Innovative Payment 2.pdf (ID: upload_1763739631732_kd3owj46q)
INFO:app.services.gcs_utils:‚úÖ File uploaded to GCS: statements/4953de18-1aa0-4b75-9cf8-f6432e90cc77/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.api.new_extract:‚úÖ Uploaded to GCS: statements/4953de18-1aa0-4b75-9cf8-f6432e90cc77/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.gcs_utils:üîê Generating signed URL for: statements/4953de18-1aa0-4b75-9cf8-f6432e90cc77/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.gcs_utils:üìù Generating signed URL with:
INFO:app.services.gcs_utils:   - Content-Type: application/pdf
INFO:app.services.gcs_utils:   - Content-Disposition: inline
INFO:app.services.gcs_utils:   - Expiration: 1 hour(s)
INFO:app.services.gcs_utils:‚úÖ Generated signed URL for GCS file with inline headers: statements/4953de18-1aa0-4b75-9cf8-f6432e90cc77/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.gcs_utils:   URL expires at: 2025-11-21 16:40:37.998375
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.orphan_cleanup_service:‚úÖ Orphan cleanup completed: no orphans found
INFO:app.services.websocket_service:Step started: Uploading Document (Step 1) for upload_id upload_1763739631732_kd3owj46q
INFO:app.db.crud.environment:‚úÖ Found existing default environment 9f4a7a57-5715-4b1e-98a9-b9901726a485 for user f6cf1764-5bfc-4352-abd9-81b72b7cf191 in company d883a865-a54f-41d6-968e-f94c3cb3f589
INFO:app.api.new_extract:‚úÖ Using user's default environment 9f4a7a57-5715-4b1e-98a9-b9901726a485 for upload consistency
INFO:app.api.new_extract:üìù Upload metadata prepared (NOT saved to DB): 4953de18-1aa0-4b75-9cf8-f6432e90cc77
INFO:app.services.audit_logging_service:Audit: data_view by user f6cf1764-5bfc-4352-abd9-81b72b7cf191 on extraction_process (ID: 4953de18-1aa0-4b75-9cf8-f6432e90cc77)
INFO:app.services.conversational_summary_service:‚úÖ ConversationalSummaryService initialized with GPT-4o
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:‚úÖ Enhanced Extraction Service initialized (OPTIMIZED)
INFO:app.services.enhanced_extraction_service:‚≠ê PRIMARY: GPT-5 Vision - AVAILABLE ‚úì
INFO:app.services.enhanced_extraction_service:   Features: Structured outputs, 60-80% token savings, 99.9% reliability
INFO:app.services.enhanced_extraction_service:üìã FALLBACK services: Lazy-loaded on demand (Claude, Mistral, DocAI, Excel)
INFO:app.services.enhanced_extraction_service:‚è±Ô∏è  Timeout management: {'metadata_extraction': 300, 'document_processing': 600, 'table_extraction': 1200, 'post_processing': 300, 'total_process': 1800}
INFO:app.services.enhanced_extraction_service:üöÄ Enhanced 3-phase pipeline: ENABLED
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:‚úÖ Using GPT-5 Vision as primary extraction service
INFO:app.services.enhanced_extraction_service:‚úÖ GPT5_VISION service validated successfully
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:‚≠ê‚≠ê‚≠ê ROUTING TO GPT-5 VISION EXTRACTION ‚≠ê‚≠ê‚≠ê
INFO:app.services.enhanced_extraction_service:   Extraction Method: smart
INFO:app.services.enhanced_extraction_service:   Features: Structured outputs, token optimization, intelligent page selection
INFO:app.services.enhanced_extraction_service:   File: pdfs/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.enhanced_extraction_service:   NOTE: Function name '_extract_with_claude_progress' is legacy - it USES GPT-5
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Started stage document_processing for upload upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Completed stage document_processing for upload upload_1763739631732_kd3owj46q
INFO:app.services.enhanced_extraction_service:‚ÑπÔ∏è Carrier from database 'Pinecrestconsulting' has no specific prompt. Continuing detection.
INFO:app.services.enhanced_extraction_service:No carrier match detected inside provided text snippet.
INFO:app.services.enhanced_extraction_service:No carrier match detected inside provided text snippet.
INFO:app.services.enhanced_extraction_service:‚úì Using carrier context for GPT prompts: Pinecrestconsulting (options: none)
INFO:app.services.enhanced_extraction_service:üì° Emitting extraction step...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Step started: Analyzing Document (Step 2) for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.enhanced_extraction_service:üì° Emitting table_extraction step...
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_STARTED
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Step started: Reading Commission Data (Step 3) for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Started stage table_detection for upload upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.enhanced_extraction_service:‚≠ê Starting GPT-5 Vision extraction for pdfs/08.06.2025 Allied Innovative Payment 2.pdf (enhanced=True)
INFO:app.services.enhanced_extraction_service:   Using structured outputs for 99.9% reliability
INFO:app.services.enhanced_extraction_service:   Token optimization: 60-80% savings via intelligent page selection
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.enhanced_extraction_service:üöÄ CALLING GPT-5 VISION SERVICE FOR EXTRACTION
INFO:app.services.enhanced_extraction_service:   File: pdfs/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.enhanced_extraction_service:   Carrier: Pinecrestconsulting
INFO:app.services.enhanced_extraction_service:   Enhanced Mode: True
INFO:app.services.enhanced_extraction_service:   Max Pages: 100 (intelligent page selection)
INFO:app.services.enhanced_extraction_service:================================================================================
INFO:app.services.gpt.enhanced_service:üöÄ Starting enhanced extraction for Pinecrestconsulting | upload_1763739639
INFO:app.services.gpt.vision_extractor:üìÑ Processing PDF with direct upload method: pdfs/08.06.2025 Allied Innovative Payment 2.pdf
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.gpt.vision_extractor:üìè Document has 7 pages (> 6 single-call limit). Using chunked extraction.
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: progress_update
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.gpt.vision_extractor:üì§ Uploading PDF: /var/folders/2g/bqpglbdx7xd0zlkzpbb60nqc0000gn/T/tmp0teowv80.pdf
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/files "HTTP/1.1 200 OK"
INFO:app.services.gpt.vision_extractor:‚úÖ PDF uploaded: file-LyPAscMU6fyRKvbM6XZuhE
INFO:app.services.gpt.dynamic_prompts:üîç GPT: Looking up carrier prompt: 'Pinecrestconsulting' ‚Üí normalized: 'pinecrestconsulting'
INFO:app.services.gpt.dynamic_prompts:‚ùå No carrier-specific prompt found for 'Pinecrestconsulting', using standard prompt only
INFO:app.services.gpt.dynamic_prompts:   Available carriers: ['UnitedHealthcare', 'United Healthcare', 'UHC', 'United Health Group', 'UnitedHealth', 'Redirect Health']
INFO:app.services.gpt.vision_extractor:üìã Extracting from PDF using Responses API (file_id: file-LyPAscMU6fyRKvbM6XZuhE)
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
INFO:app.services.websocket_service:Broadcasting message to upload_id upload_1763739631732_kd3owj46q: STEP_PROGRESS
INFO:app.services.websocket_service:Found 1 connections for upload_id upload_1763739631732_kd3owj46q
